<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="模块化开发,">










<meta name="description" content="在JavaScript发展初期就是为了实现简单的页面交互逻辑，寥寥数语即可，现在的前端开发, 不仅仅是完成浏览的基本需求，并且通常是一个单页面应用，每一个视图通过异步的方式加载，这导致页面初始化和使用过程中会加载越来越多的JavaScript代码。如何在开发环境组织好这些碎片化的代码和资源，并且保证他们在浏览器端快速、优雅的加载和更新，就需要一个模块化系统。  模块化概述什么是模块化模板化是在文">
<meta name="keywords" content="模块化开发">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈前端模块化开发">
<meta property="og:url" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/index.html">
<meta property="og:site_name" content="Eline blog">
<meta property="og:description" content="在JavaScript发展初期就是为了实现简单的页面交互逻辑，寥寥数语即可，现在的前端开发, 不仅仅是完成浏览的基本需求，并且通常是一个单页面应用，每一个视图通过异步的方式加载，这导致页面初始化和使用过程中会加载越来越多的JavaScript代码。如何在开发环境组织好这些碎片化的代码和资源，并且保证他们在浏览器端快速、优雅的加载和更新，就需要一个模块化系统。  模块化概述什么是模块化模板化是在文">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/amd.png">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/esm1.png">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/node.png">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/node1.png">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/node2.png">
<meta property="og:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/node3.png">
<meta property="og:updated_time" content="2020-12-24T07:47:26.642Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浅谈前端模块化开发">
<meta name="twitter:description" content="在JavaScript发展初期就是为了实现简单的页面交互逻辑，寥寥数语即可，现在的前端开发, 不仅仅是完成浏览的基本需求，并且通常是一个单页面应用，每一个视图通过异步的方式加载，这导致页面初始化和使用过程中会加载越来越多的JavaScript代码。如何在开发环境组织好这些碎片化的代码和资源，并且保证他们在浏览器端快速、优雅的加载和更新，就需要一个模块化系统。  模块化概述什么是模块化模板化是在文">
<meta name="twitter:image" content="http://yoursite.com/2020/12/23/浅谈前端模块化开发/amd.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/12/23/浅谈前端模块化开发/">





  <title>浅谈前端模块化开发 | Eline blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eline blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/23/浅谈前端模块化开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eline">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/cat.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eline blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">浅谈前端模块化开发</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-23T20:30:52+08:00">
                2020-12-23
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-12-24T15:47:26+08:00">
                2020-12-24
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/" itemprop="url" rel="index">
                    <span itemprop="name">CommonJs</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/ES-Modules/" itemprop="url" rel="index">
                    <span itemprop="name">ES Modules</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/ES-Modules/AMD/" itemprop="url" rel="index">
                    <span itemprop="name">AMD</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/ES-Modules/AMD/CMD/" itemprop="url" rel="index">
                    <span itemprop="name">CMD</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/ES-Modules/AMD/CMD/组件化/" itemprop="url" rel="index">
                    <span itemprop="name">组件化</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CommonJs/ES-Modules/AMD/CMD/组件化/模块化/" itemprop="url" rel="index">
                    <span itemprop="name">模块化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>在JavaScript发展初期就是为了实现简单的页面交互逻辑，寥寥数语即可，现在的前端开发, 不仅仅是完成浏览的基本需求，并且通常是一个单页面应用，每一个视图通过异步的方式加载，这导致页面初始化和使用过程中会加载越来越多的JavaScript代码。如何在开发环境组织好这些碎片化的代码和资源，并且保证他们在浏览器端快速、优雅的加载和更新，就需要一个模块化系统。</p>
</blockquote>
<h2 id="模块化概述"><a href="#模块化概述" class="headerlink" title="模块化概述"></a>模块化概述</h2><h3 id="什么是模块化"><a href="#什么是模块化" class="headerlink" title="什么是模块化"></a>什么是模块化</h3><p><strong>模板化是在文件层面上，对代码和资源的拆分。</strong>就是将一个大文件拆分成相互依赖的小文件，再进行统一的拼装和加载。</p>
<p>那具体什么是模块化呢，举一个简单的例子，我们要写一个实现A功能的JS代码，这个功能在项目其他位置也需要用到，那么我们就可以把这个功能看成一个模块采用一定的方式进行模块化编写，既能实现复用还可以分而治之，同理在写样式的时候，如果我们需要某种特殊的样式，会在很多地方应用，那么我们也可以采用一定的方式进行CSS的模块化。具体说来，JS模块化方案很多有AMD/CommonJS/UMD/ES6 Module等，CSS模块化开发大多是在less、sass、stylus等预处理器的import/mixin特性支持下实现的。</p>
<blockquote>
<p>分而治之：将一个大问题分解成多个较为独立的与原问题性质相同的小问题，将所有的小问题的解答组合起来即可得到大问题的答案。</p>
</blockquote>
<p>说到模块化，肯定会想起组件化，那么什么是<strong>组件化</strong>？</p>
<p><strong>组件化是在设计层面上，对于UI的拆分。</strong></p>
<p>组件化将页面视为一个容器，页面上各个独立部分例如：头部、导航、焦点图、侧边栏、底部等视为独立组件，不同的页面根据内容的需要，使用对应的组件即可组成完整的页面。</p>
<p>组件具有独立性，因此组件与组件之间可以自由组合，当不需要某个组件，或者想要替换组件时，可以整个目录删除/替换。</p>
<p><strong>组件化模块化优点</strong>：开发调试效率高、可维护性强、避免阻断、版本管理更容易</p>
<h3 id="模块化的发展过程"><a href="#模块化的发展过程" class="headerlink" title="模块化的发展过程"></a>模块化的发展过程</h3><h4 id="1-原始写法（文件划分方式）"><a href="#1-原始写法（文件划分方式）" class="headerlink" title="1. 原始写法（文件划分方式）"></a>1. 原始写法（文件划分方式）</h4><p>将每个功能以及相关状态的数据，单独存放在不同的文件中，约定每个文件就是一个独立的模块，将不同的功能封装成不同的全局函数，使用模块就是通script标签将模块引入到页面中，一个script标签就对应一个模块，在代码中直接调用模块的全局成员（变量或者函数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-a.js </span></span><br><span class="line"><span class="comment">// module a 相关状态数据和功能函数</span></span><br><span class="line"><span class="keyword">var</span> name =<span class="string">"module-a"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-b.js </span></span><br><span class="line"><span class="comment">// module b 相关状态数据和功能函数</span></span><br><span class="line"><span class="keyword">var</span> name =<span class="string">"module-b"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"module-a.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"module-b.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 命名冲突</span></span></span><br><span class="line"><span class="undefined">        foo()</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 模块成员可以被修改</span></span></span><br><span class="line"><span class="javascript">        name=<span class="string">'foo'</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>存在问题：污染全局作用域, 容易引起命名冲突或数据不安全，无法管理模块依赖关系</p>
<h4 id="2-对象的写法（命名空间的方式）"><a href="#2-对象的写法（命名空间的方式）" class="headerlink" title="2. 对象的写法（命名空间的方式）"></a>2. 对象的写法（命名空间的方式）</h4><p>为了解决上面的缺点，可以把模块写成一个对象，所有的模块成员都放到这个对象里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-a.js </span></span><br><span class="line"><span class="keyword">var</span> moduleA = &#123;</span><br><span class="line">    name: <span class="string">"module-a"</span>,</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span></span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span></span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-b.js </span></span><br><span class="line"><span class="keyword">var</span> moduleB = &#123;</span><br><span class="line">    name: <span class="string">"module-b"</span>,</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span></span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span></span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"module-a.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"module-b.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        moduleA.foo()</span></span><br><span class="line"><span class="undefined">        moduleB.foo()</span></span><br><span class="line"><span class="javascript">        moduleA.name=<span class="string">'foo'</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>存在问题: 这样的写法会暴露所有模块成员，内部状态可以被外部改写，外部可以直接修改模块内部的数据</p>
<h4 id="3-立即执行函数写法（IIFE-Immediately-Invoked-Function-Expression）"><a href="#3-立即执行函数写法（IIFE-Immediately-Invoked-Function-Expression）" class="headerlink" title="3. 立即执行函数写法（IIFE Immediately-Invoked Function Expression）"></a>3. 立即执行函数写法（IIFE Immediately-Invoked Function Expression）</h4><p>匿名函数自调用(闭包),将变量设置为私有成员，外部只能通过暴露的方法操作,确保了私有变量的安全</p>
<p>具体做法就是将每个模块成员都放在一个函数提供的私有作用域中，对于需要暴露给外部的成员，通过挂在到全局对象上的方式实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-a.js</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name= <span class="string">"module-a"</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//暴露行为ES6</span></span><br><span class="line">  <span class="built_in">window</span>.moduleA = &#123; foo, bar &#125; </span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-b.js</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name= <span class="string">"module-b"</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name+<span class="string">'#foo'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name+<span class="string">'#bar'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//暴露行为ES6</span></span><br><span class="line">  <span class="built_in">window</span>.moduleB = &#123; foo, bar &#125; </span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"module.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    moduleA.foo()</span></span><br><span class="line"><span class="undefined">    moduleB.bar()</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(moduleA.name) <span class="comment">//undefined 不能访问模块内部数据</span></span></span><br><span class="line"><span class="javascript">    moduleA.name = <span class="string">'xxxx'</span> <span class="comment">//不是修改的模块内部的data</span></span></span><br><span class="line"><span class="javascript">    moduleA.foo() <span class="comment">//没有改变</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>IIFE模式增强 : 引入依赖</strong><br>自执行函数的参数作为依赖的声明使用，是的每个模块的之间的依赖关系变得更加明显</p>
<p>这就是现代模块实现的基石</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module-a.js文件</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'module-a'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name + <span class="string">'#foo'</span>)</span><br><span class="line">    $(<span class="string">'body'</span>).animate(&#123; <span class="attr">background</span>: <span class="string">'red'</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name + <span class="string">'#bar'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.moduleA = &#123;foo, bar&#125;</span><br><span class="line">&#125;)(jQuery)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// index.html文件</span><br><span class="line">  <span class="comment">&lt;!-- 引入的js必须有一定顺序 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery-1.10.1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"module-a.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    moduleA.foo()</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上例子通过jquery方法将页面的背景颜色改成红色，所以必须先引入jQuery库，就把这个库当作参数传入。<strong>这样做除了保证模块的独立性，还使得模块之间的依赖关系变得明显</strong>。</p>
<p><strong>模块化好处</strong>：</p>
<ul>
<li>避免命名冲突(减少命名空间污染)</li>
<li>更好的分离, 按需加载</li>
<li>更高复用性</li>
<li>高可维护性</li>
</ul>
<p><strong>引入多个<code>&lt;script&gt;</code>后出现出现问题</strong></p>
<ul>
<li>请求过多</li>
</ul>
<p>首先我们要依赖多个模块，那样就会发送多个请求，导致请求过多</p>
<ul>
<li>依赖模糊</li>
</ul>
<p>我们不知道他们的具体依赖关系是什么，也就是说很容易因为不了解他们之间的依赖关系导致加载先后顺序出错。</p>
<ul>
<li>难以维护</li>
</ul>
<p>以上两种原因就导致了很难维护，很可能出现牵一发而动全身的情况导致项目出现严重的问题。<br>模块化固然有多个好处，然而一个页面需要引入多个js文件，就会出现以上这些问题。而这些问题可以通过模块化规范来解决，下面介绍开发中最流行的commonjs, AMD, CMD, ES6规范。</p>
<h2 id="模块化的规范"><a href="#模块化的规范" class="headerlink" title="模块化的规范"></a>模块化的规范</h2><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>CommonJS是服务器端模块的规范，NodeJs采用了这个规范，并且是以同步模式加载模块，约定如下：</p>
<ul>
<li>一个文件就是一个模块，每个模块有单独的作用域</li>
<li>在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见</li>
<li>在服务器端，模块的加载是运行时同步加载的</li>
<li>在浏览器端，模块需要提前编译打包处理</li>
<li>导出模块：module.exports = value或exports.xxx = value<br>CommonJS规范规定，每个模块内部，module变量代表当前模块。这个变量是一个对象，它的exports属性（即module.exports）是对外的接口。加载某个模块，其实是加载该模块的module.exports属性。</li>
<li>引入模块：require(xxx),如果是第三方模块，xxx为模块名；如果是自定义模块，xxx为模块文件路径<br>require命令用于加载模块文件。require命令的基本功能是，读入并执行一个JavaScript文件，然后返回该模块的exports对象。如果没有发现指定模块，会报错。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.js</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">var</span> addX = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value + x;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports.x = x;</span><br><span class="line"><span class="built_in">module</span>.exports.addX = addX;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果参数字符串以“./”开头，则表示加载的是一个位于相对路径</span></span><br><span class="line"><span class="keyword">var</span> example = <span class="built_in">require</span>(<span class="string">'./example.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(example.x); <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">console</span>.log(example.addX(<span class="number">1</span>)); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><ul>
<li>优点：<ul>
<li>所有代码都运行在模块作用域，不会污染全局作用域。</li>
<li>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</li>
<li>模块加载的顺序，按照其在代码中出现的顺序。</li>
</ul>
</li>
<li>缺点：<ul>
<li>同步的模块加载方式不适合在浏览器环境中，同步意味着阻塞加载，浏览器资源是异步加载的</li>
<li>不能非阻塞的并行加载多个模块</li>
</ul>
</li>
</ul>
<h4 id="模块的加载机制"><a href="#模块的加载机制" class="headerlink" title="模块的加载机制"></a>模块的加载机制</h4><p>CommonJS模块的加载机制是，输入的是被输出的值的拷贝。也就是说，一旦输出一个值，模块内部的变化就影响不到这个值。这点与ES6模块化有重大差异，请看下面这个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">3</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  count,</span><br><span class="line">  addCount</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面代码输出内部变量count和改写这个变量的内部方法addCount。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;count,addCount&#125;= <span class="built_in">require</span>(<span class="string">'./module.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(count);  <span class="comment">// 3</span></span><br><span class="line">addCount();</span><br><span class="line"><span class="built_in">console</span>.log(count); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>上面代码说明，count输出以后，module.js模块内部的变化就影响不到count了。这是因为count是一个原始类型的值，会被缓存。除非写成一个函数，才能得到内部变动后的值。</p>
<h3 id="AMD（Asynchronous-Module-Definition）"><a href="#AMD（Asynchronous-Module-Definition）" class="headerlink" title="AMD（Asynchronous Module Definition）"></a>AMD（Asynchronous Module Definition）</h3><p>CommonJS规范加载模块是同步的，所以只有加载完成才能执行后面的操作。像Node.js主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快，不用考虑异步加载的方式，所以CommonJS规范比较适用。但如果是浏览器环境，要从服务器端加载模块，这是就必须采用异步模式，结合浏览器的特殊情况，AMD 规范应运而生。</p>
<h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><ul>
<li>定义模块<br>AMD约定需要通过一个叫做<strong>define()</strong>去定义一个模块</li>
</ul>
<p>define(id?, dependencies?, factory)它要在声明模块的时候指定所有的依赖dependencies，并且还要当做形参传到factory 中，对于依赖的模块提前执行，依赖前置。</p>
<ul>
<li>id：字符串，表示模块名，方便后期通过模块名进行使用</li>
<li>dependencies：数组，用来声明这个模块的一些依赖项，此参数按需添加，可有可无</li>
<li>factory：函数，函数的参数和依赖项一一对应，分别是前面依赖项各自导出的成员。函数的作用则是为模块提供一个私有的空间，通过return的方式导出外部所需的成员。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">"module"</span>, [<span class="string">"dep1"</span>, <span class="string">"dep2"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">d1, d2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> someExportedValue;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">require</span>([<span class="string">"module"</span>, <span class="string">"../file"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">module, file</span>) </span>&#123; <span class="comment">/* ... */</span> &#125;);</span><br></pre></td></tr></table></figure>
<p> 定义一个名为 module 的模块，它依赖 jQuery和module2 模块<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//module.js</span></span><br><span class="line">define(<span class="string">"module"</span>, [<span class="string">"jquery"</span>, <span class="string">"./module2"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">$, module2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">          $(body).animate(&#123;<span class="attr">margin</span>:<span class="string">'200px'</span>&#125;)</span><br><span class="line">          module2()</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>引入模块</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">"./module"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">module1</span>) </span>&#123;</span><br><span class="line">    module1.start()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Require.js 是 AMD 规范诞生同期非常出名的库，它实现了 AMD 规范，且它本身也是一个强大的模块加载器。</p>
<h4 id="未使用AMD规范与使用require-js比较"><a href="#未使用AMD规范与使用require-js比较" class="headerlink" title="未使用AMD规范与使用require.js比较"></a>未使用AMD规范与使用require.js比较</h4><ul>
<li><p>未使用AMD规范</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dataService.js文件</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> msg = <span class="string">'www.baidu.com'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> msg.toUpperCase()</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.dataService = &#123;getMsg&#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alerter.js文件</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window, dataService</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">'Tom'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(dataService.getMsg() + <span class="string">', '</span> + name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.alerter = &#123;showMsg&#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>, dataService)</span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">alerter</span>) </span>&#123;</span><br><span class="line">alerter.showMsg()</span><br><span class="line">&#125;)(alerter)</span><br></pre></td></tr></table></figure>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Modular Demo 1: 未使用AMD(require.js)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/modules/dataService.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/modules/alerter.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  运行结果：<br>  <img src="/2020/12/23/浅谈前端模块化开发/amd.png" alt></p>
<p>  这种方式缺点很明显：首先会发送多个请求，其次引入的js文件顺序不能搞错，否则会报错，可维护性也比较差。</p>
</li>
<li><p>使用require.js<br>RequireJS是一个工具库，主要用于客户端的模块管理。它的模块管理遵守AMD规范，RequireJS的基本思想是，通过define方法，将代码定义为模块；通过require方法，实现代码的模块加载。<br>接下来介绍AMD规范在浏览器实现的步骤：</p>
<p>  <strong>1. 下载require.js, 并引入</strong><br>  <a href="http://www.requirejs.cn/" target="_blank" rel="noopener">官网</a>  <a href="https://github.com/requirejs/requirejs" target="_blank" rel="noopener">github</a></p>
<p>  然后将require.js导入项目: js/libs/require.js<br>  <strong>2. 创建项目结构</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|-js</span><br><span class="line">|-libs</span><br><span class="line">    |-require.js</span><br><span class="line">|-modules</span><br><span class="line">    |-alerter.js</span><br><span class="line">    |-dataService.js</span><br><span class="line">|-main.js</span><br><span class="line">|-index.html</span><br></pre></td></tr></table></figure>
<p>  <strong>3. 定义require.js的模块代码并引入</strong></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dataService.js文件</span></span><br><span class="line"><span class="comment">// 定义没有依赖的模块</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> msg = <span class="string">'www.baidu.com'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> msg.toUpperCase()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &#123; getMsg &#125; <span class="comment">// 暴露模块</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//alerter.js文件</span></span><br><span class="line"><span class="comment">// 定义有依赖的模块,引入第三方库jQuery</span></span><br><span class="line">define([<span class="string">'dataService'</span>, <span class="string">'jquery'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">dataService, $</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">'Tom'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(dataService.getMsg() + <span class="string">', '</span> + name)</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'green'</span>)</span><br><span class="line"><span class="comment">// 暴露模块</span></span><br><span class="line"><span class="keyword">return</span> &#123; showMsg &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js文件</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">require</span>.config(&#123;</span><br><span class="line">    baseUrl: <span class="string">'js/'</span>, <span class="comment">//基本路径 出发点在根目录下</span></span><br><span class="line">    paths: &#123;</span><br><span class="line">    <span class="comment">//自定义模块</span></span><br><span class="line">    alerter: <span class="string">'./modules/alerter'</span>, <span class="comment">//此处不能写成alerter.js,会报错</span></span><br><span class="line">    dataService: <span class="string">'./modules/dataService'</span>,</span><br><span class="line">    <span class="comment">// 第三方库模块</span></span><br><span class="line">    jquery: <span class="string">'./libs/jquery-1.10.1'</span> <span class="comment">//注意：写成jQuery会报错</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">require</span>([<span class="string">'alerter'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">alerter</span>) </span>&#123;</span><br><span class="line">    alerter.showMsg()</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>  上例是在alerter.js文件中引入jQuery第三方库，main.js文件也要有相应的路径配置</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Modular Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入require.js并指定js主文件的入口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">"js/main"</span> <span class="attr">src</span>=<span class="string">"js/libs/require.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  通过两者的比较，可以得出AMD模块定义的方法非常清晰，不会污染全局环境，能够清楚地显示依赖关系。AMD模式可以用于浏览器环境，并且允许异步加载模块，并行加载多个模块，也可以根据需要动态加载模块。<br>  <strong>缺点</strong></p>
<ul>
<li>开发成本高，代码的阅读和书写比较困难，模块定义方式的语义不顺畅；</li>
<li>不符合通用的模块化思维方式，是一种妥协的实现；</li>
</ul>
</li>
</ul>
<h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>CMD(Common Module Definition)，通用的模块定义规范，类似 CommonJs 规范。Sea.js 是由淘宝推出的库，遵循CMD规范。</p>
<h4 id="CMD规范基本语法"><a href="#CMD规范基本语法" class="headerlink" title="CMD规范基本语法"></a>CMD规范基本语法</h4><p><strong>定义模块：</strong></p>
<ul>
<li><p>定义没有依赖的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)</span>&#123;</span><br><span class="line">  exports.xxx = value</span><br><span class="line">  <span class="built_in">module</span>.exports = value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义有依赖的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//引入依赖模块(同步)</span></span><br><span class="line">  <span class="keyword">var</span> module2 = <span class="built_in">require</span>(<span class="string">'./module2'</span>)</span><br><span class="line">  <span class="comment">//引入依赖模块(异步)</span></span><br><span class="line">    <span class="built_in">require</span>.async(<span class="string">'./module3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">m3</span>) </span>&#123;</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="comment">//暴露模块</span></span><br><span class="line">  exports.xxx = value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>引入使用模块：</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">require</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> m1 = <span class="built_in">require</span>(<span class="string">'./module1'</span>)</span><br><span class="line">  <span class="keyword">var</span> m4 = <span class="built_in">require</span>(<span class="string">'./module4'</span>)</span><br><span class="line">  m1.show()</span><br><span class="line">  m4.show()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>优点</strong>：依赖就近，延迟执行 可以很容易在 Node.js 中运行；<br><strong>缺点</strong>：依赖 SPM 打包，模块的加载逻辑偏重；</p>
<h3 id="ES6-Modules（模块化的最佳实践）"><a href="#ES6-Modules（模块化的最佳实践）" class="headerlink" title="ES6 Modules（模块化的最佳实践）"></a>ES6 Modules（模块化的最佳实践）</h3><p>目前前端模块化规范上统一为：<strong>Node.js上使用 CommonJS 规范，浏览器 上使用 ES Modules 规范</strong><br>ES Modules规范是在 ECMAScript2015(ES6)中提出的 Module 模块标准，其设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量，而CommonJS 和 AMD 模块，都只能在运行时确定这些东西，比如，CommonJS 模块就是对象，输入时必须查找对象属性。</p>
<h4 id="ES-Module基本特性"><a href="#ES-Module基本特性" class="headerlink" title="ES Module基本特性"></a>ES Module基本特性</h4><p>通过给 script 添加 type = module 的属性，就可以以 ES Module 的标准执行其中的 JS 代码</p>
<ul>
<li>ESM 会自动采用严格模式，忽略 ‘use strict’</li>
</ul>
<p>也就是即使不加 use strict ，它内部的 JS 也将是严格模式执行的。严格模式下，this 为 undefined；非严格模式下，this 为 window</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">//undefined</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>每个ESM都是运行在单独的私有作用域中<br>通过使用多个 script 来分割代码为不同模块，模块间的作用域都将是独立互不影响的。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> foo = <span class="number">100</span>  <span class="comment">//不会造成全局作用域的污染</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(foo); <span class="comment">// 100</span></span></span><br><span class="line"><span class="undefined">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">       <span class="built_in">console</span>.log(foo); <span class="comment">// Uncaught ReferenceError: foo is not defined</span></span></span><br><span class="line"><span class="undefined">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ESM 是通过 CORS 的跨域请求方式请求外部 JS 模块的<br>既然是 CORS 的方式，那么说明我们通过 src 引用的 JS 必须是同源的，服务端要支持CORS，否则将会存在跨域问题</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/23/浅谈前端模块化开发/esm1.png" alt></p>
<ul>
<li>ESM 的 script 标签会延迟执行脚本，相当于 script 的 defer 属性</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"./demo.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 等待网页的渲染过后，再去执行脚本，不会阻碍页面的显示</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>需要显示的内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>网页默认是先执行 JS 再进行渲染的，而延迟执行则会先使网页完成渲染，再执行 JS 代码。</p>
<h4 id="ES-Module-导入和导出（最为核心和常用的功能）"><a href="#ES-Module-导入和导出（最为核心和常用的功能）" class="headerlink" title="ES Module 导入和导出（最为核心和常用的功能）"></a>ES Module 导入和导出（最为核心和常用的功能）</h4><p>export命令用于规定模块的对外接口，import 是在模块内导入其他模块所提供的接口。</p>
<h5 id="导出导入语法"><a href="#导出导入语法" class="headerlink" title="导出导入语法"></a>导出导入语法</h5><ul>
<li>可以单独成员导出，也可以集中导出，集中导出可以更加直观的看到向外部导出了哪些成员</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line"><span class="comment">// 第一种：分别导出</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">var</span> name = <span class="string">'foo module'</span>   <span class="comment">// 导出变量 </span></span><br><span class="line">  <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span> (<span class="params"></span>) </span>&#123; &#125;     <span class="comment">// 导出函数</span></span><br><span class="line">  <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;          <span class="comment">// 导出类  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种：集中导出</span></span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'foo module'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hello</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line">  <span class="keyword">export</span> &#123; name, hello, Person &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="comment">// .js 不可以省略，完整路径 module_path:导入模块的名称</span></span><br><span class="line">  <span class="keyword">import</span> &#123; name, hello, Person &#125; <span class="keyword">from</span> <span class="string">'module_path'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>别名导出，使用 as 进行重命名</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'foo module'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hello</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">export</span> &#123; name <span class="keyword">as</span> fooName, hello <span class="keyword">as</span> fooHello, Person <span class="keyword">as</span> fooPerson &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="comment">// 第一种</span></span><br><span class="line">  <span class="keyword">import</span> &#123; fooName, fooHello, fooPerson &#125; <span class="keyword">from</span> <span class="string">'module_path'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种： 提取模块导出的所有成员, 使用 as 将所有成员作为一个对象的属性</span></span><br><span class="line">  <span class="keyword">import</span> * <span class="keyword">as</span> mod <span class="keyword">from</span> <span class="string">'module_path'</span></span><br><span class="line">  <span class="built_in">console</span>.log(mod.name, mod.age);</span><br></pre></td></tr></table></figure>
<ul>
<li>默认导出，设置某一个成员的别名是 default</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'foo module'</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">export</span> &#123; name <span class="keyword">as</span> <span class="keyword">default</span> &#125;</span><br><span class="line">  <span class="comment">// &lt;==&gt; 推荐下方书写方式</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> name</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line">  <span class="keyword">import</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> name &#125;  <span class="keyword">from</span> <span class="string">'module_path'</span> <span class="comment">// default 是关键字</span></span><br><span class="line">  <span class="comment">// 简写为</span></span><br><span class="line">  <span class="keyword">import</span> name <span class="keyword">from</span> <span class="string">'module_path'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>导入模块时，模块路径的三种写法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./ 不可以省略，相对路径 .js 的文件扩展名是不可省略的，省略会直接报错</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// / 绝对路径</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'/import/module.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整 url 路径</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'http://localhost:2080/module.js'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>加载模块，但不提取模块内的成员，一般用于导入一些不需要外部控制的子功能模块</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;&#125; <span class="keyword">from</span> <span class="string">'module_path'</span></span><br><span class="line"><span class="comment">// 简写为</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'module_path'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在脚本运行时动态引入模块<br>我们总会有这样的需求：模块的名字在脚本运行时才得到，或者在 if 条件里才可以导入而 import 关键字仅支持在全局最顶部出现 我们又不能像下面这样使用 import</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不能这样用</span></span><br><span class="line"><span class="keyword">const</span> modulePath = <span class="string">'./module.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123; text &#125; <span class="keyword">from</span> modulePath</span><br><span class="line"><span class="comment">// 也不能这样用</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">  <span class="keyword">import</span> &#123; text &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ESM 提供了一个全局的函数，使之能够动态地导入模块，具体用法如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'module_path'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">module</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>因为模块加载是一个异步过程，该函数返回一个 Promise</p>
<ul>
<li>同时提取具名和默认成员</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line">  <span class="keyword">let</span> name= <span class="string">"Tom"</span></span><br><span class="line">  <span class="keyword">let</span> age =<span class="number">18</span></span><br><span class="line"><span class="comment">// 具名成员</span></span><br><span class="line">  <span class="keyword">export</span> &#123;name,age&#125;</span><br><span class="line"><span class="comment">//   默认成员</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'default export'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line">  <span class="keyword">import</span> &#123; name, age, <span class="keyword">default</span> <span class="keyword">as</span> d &#125; <span class="keyword">from</span> <span class="string">'module_path'</span></span><br><span class="line">  <span class="comment">// 简写为, 默认成员的名字可以随意命名</span></span><br><span class="line">  <span class="keyword">import</span> d, &#123; name, age &#125; <span class="keyword">from</span> <span class="string">'module_path'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ES Modules 直接导出导入的成员（二次导出）</li>
</ul>
<p>import配合export使用，将导入的结果，直接作为当前模块的导出成员，当前作用域就不在访问这些成员</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// button.js</span></span><br><span class="line"><span class="keyword">var</span> Button = <span class="string">"Button Component"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Button</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">export</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> Button&#125; <span class="keyword">from</span> <span class="string">'./button.js'</span></span><br></pre></td></tr></table></figure>
<p>默认导出时候，导入提取default需要重命名，否则会作为index.js的默认导出，外界只能通过default方式使用</p>
<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><ul>
<li>export 单独使用时， {} 是固定语法，导出的不是对象字面量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'jack'</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; name, age &#125;</span><br></pre></td></tr></table></figure>
<p>导入模块，{} 固定语法，不是对象的解构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>export default 组合使用时，{} 代表导出的是对象字面量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'jack'</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; name, age &#125;</span><br></pre></td></tr></table></figure>
<p>导入模块，不可以使用 {} 写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module_obj 自定义名字，最好和模块名保持一致</span></span><br><span class="line"><span class="keyword">import</span> module_obj <span class="keyword">from</span> <span class="string">'./module.js'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问导出的成员</span></span><br><span class="line"><span class="built_in">console</span>.log(module_obj.name, module_obj.age)</span><br></pre></td></tr></table></figure>
<ul>
<li>export 导出的是值的内存地址</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'jack'</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line"><span class="comment">// 导出的是值的内存地址,不是把值复制一份</span></span><br><span class="line"><span class="keyword">export</span> &#123; name, age &#125; </span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    name = <span class="string">'ben'</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过引用获取值</span></span><br><span class="line">  <span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line">   </span><br><span class="line">  <span class="built_in">console</span>.log(name, age);  <span class="comment">// jack 18</span></span><br><span class="line">  </span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, age); <span class="comment">// ben 18</span></span><br><span class="line">  &#125;, <span class="number">1500</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ESM 导出的引用在外部是无法进行修改的，导入时会自动转为只读常量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line"></span><br><span class="line">name = <span class="string">'tom'</span> <span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>点+斜线不可省略</li>
</ul>
<p>这里的 ./ 开头是不可省略的，如果省略的话，ES Modules 会认为我们是在加载第三方库</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>即使是导入目录下的 index 文件，也需填写完整，不会默认导出目录下的 index</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">'./module/index.js'</span></span><br></pre></td></tr></table></figure>
<h4 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h4><p>ESM是ES6提出，是近几年出现的模块化标准方案，早期浏览器不支持，IE和国产浏览器目前不支持。Polyfill 这个方案，它能够让浏览器支持绝大部分 ES Modules 的特性。这个模块的名字叫做：<a href="https://github.com/ModuleLoader/browser-es-module-loader" target="_blank" rel="noopener">ES Module Loader</a> </p>
<p>IE不见兼容ESM解决方法：</p>
<ul>
<li>借助编译工具，把ES6代码编译成ES5形式再去工作，这里先不做介绍</li>
<li>使用browser-es-module-loader解决</li>
</ul>
<p>这里主要说一下如何使用browser-es-module-loader来解决</p>
<ol>
<li>在HTML页面，手动引入<code>browser-es-module-loader</code>文件，对应js文件查找的地址:<a href="https://unpkg.com/browse/browser-es-module-loader@0.4.1/dist/" target="_blank" rel="noopener">browser-es-module-loader</a></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 有的IE版本不支持 Promise，因此需要引入 Promise Polyfill --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/promise-polyfill@8.2.0/dist/polyfill.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- babel 即时运行在浏览器上的版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/browser-es-module-loader@0.4.1/dist/babel-browser-build.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ES Modules Loader, 读取代码，将不识别的特性交给 babel 进行转换 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/browser-es-module-loader@0.4.1/dist/browser-es-module-loader.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>nomodule 属性，表示只在不支持 ES Modules 的浏览器中运行，避免支持的浏览器多次运行 。</li>
<li>babel-browser-build.js 是 babel 即时运行在浏览器的版本文件，<strong>polyfill 的工作原理</strong>实际上就是通过 es module 把代码读出来，然后交给 babel 去转换，从而让代码正常工作。值得一提的是，在 IE 浏览器上，即使通过这样去引入 es module loader，也无法正常运行脚本，因为 IE 还没有支持 Promise 所以我们还需要专门为 IE 引入<a href="https://github.com/taylorhakes/promise-polyfill" target="_blank" rel="noopener">Promise Polyfill</a>。</li>
<li><strong>适合本地测试，不适合生产环境</strong>，原理都是在运行阶段动态的解析脚本，效率比较差，生产环境使用工具将ES6编译成ES6，在浏览器中正常工作</li>
</ul>
<h4 id="ES-Modules-in-Node-js"><a href="#ES-Modules-in-Node-js" class="headerlink" title="ES Modules in Node.js"></a>ES Modules in Node.js</h4><p>Node 8.5 版本过后，内部就开始以实验的方式支持ES Modules 了：<br><a href="https://github.com/nodejs/node/tree/master/lib/internal/modules" target="_blank" rel="noopener">Github ES Modules in Node.js</a><br><img src="/2020/12/23/浅谈前端模块化开发/node.png" alt></p>
<h5 id="ES-Modules-在-node-js-环境的使用"><a href="#ES-Modules-在-node-js-环境的使用" class="headerlink" title="ES Modules 在 node.js 环境的使用"></a>ES Modules 在 node.js 环境的使用</h5><p><img src="/2020/12/23/浅谈前端模块化开发/node1.png" alt></p>
<p>如上代码所示：<br>添加参数 – experimental-modules ， 启动 ES Modules 的实验特性</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node --experimental-modules xxx.mjs # node 8.5+</span><br></pre></td></tr></table></figure>
<h5 id="ES-Modules-与-CommonJS-交互"><a href="#ES-Modules-与-CommonJS-交互" class="headerlink" title="ES Modules 与 CommonJS 交互"></a>ES Modules 与 CommonJS 交互</h5><ol>
<li>ES Modules 中可以导入 CommonJS 模块</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commonJs.js</span></span><br><span class="line">  <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">      foo: <span class="string">'commonjs'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// exports 是 module.exports 的别名，二者是等价的</span></span><br><span class="line">  exports.foo = <span class="string">'commonjs'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es-modules.mjs</span></span><br><span class="line">  <span class="keyword">import</span> mod <span class="keyword">from</span> <span class="string">'./common.js'</span></span><br><span class="line">  <span class="built_in">console</span>.log(mod);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>CommonJS 中不能导入 ES Modules 模块</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commonJs.js</span></span><br><span class="line">  <span class="keyword">const</span> mod = <span class="built_in">require</span>(<span class="string">'./es-module.mjs'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(mod); <span class="comment">// Error [ERR_REQUIRE_ESM]: Must use import to load ES Module</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es-modules.mjs</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="string">'es module export value'</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>CommonJS 始终只会导出一个默认成员，不能直接提取成员</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commonJs.js</span></span><br><span class="line">  exports.foo = <span class="string">'commonjs'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es-modules.mjs</span></span><br><span class="line">  <span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'./common.js'</span> <span class="comment">// SyntaxError:...</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>注意 import 不是解构导出对象</li>
</ol>
<h5 id="ES-Modules-与-CommonJs-的差异"><a href="#ES-Modules-与-CommonJs-的差异" class="headerlink" title="ES Modules 与 CommonJs 的差异"></a>ES Modules 与 CommonJs 的差异</h5><ol>
<li>CommonJS 模块输出的是一个值的拷贝，ES Modules 模块输出的是值的引用。</li>
</ol>
<p>​      CommonJS中，查看上面的模块的加载机制部分</p>
<p>​      ES Modules中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> count = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; count, addCount &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(count); <span class="comment">// 3</span></span><br><span class="line">addCount();</span><br><span class="line"><span class="built_in">console</span>.log(count); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>​     ES Modules 模块的运行机制与 CommonJS 不一样。ES6 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。</p>
<ol start="2">
<li>CommonJS 模块是运行时加载，ES Modules模块是编译时输出接口。</li>
</ol>
<p>​       因为 CommonJS 加载的是一个对象（即module.exports属性），该对象只有在脚本运行完才会生成。而 ES6 模块不是对象，它的对外接口只是一种静态定  </p>
<p>​        义，在代码静态解析阶段就会生成。</p>
<ol start="3">
<li>ES Modules 中没有 CommonJs 中的那些模块全局成员<br>这些成员都是commonjs把模块包装函数后通过参数提供进来的成员，ESM中的加载方式与commonjs不同，所以不再提供这几个成员了<br><img src="/2020/12/23/浅谈前端模块化开发/node2.png" alt></li>
</ol>
<p>​      CommonJs中的module.exports可以通过ESM中的export替代,require通过import替代，<strong>filename和</strong>dirname可以通过import.meta.url代替</p>
<p><img src="/2020/12/23/浅谈前端模块化开发/node3.png" alt></p>
<p>​       如果使用ESM运行commonjs文件，将会报错，需要将commonjs文件的后缀改为cjs,就可以正常使用commonjs的规范</p>
<h5 id="低版本-Node-js，使用-Babel-进行兼容"><a href="#低版本-Node-js，使用-Babel-进行兼容" class="headerlink" title="低版本 Node.js，使用 Babel 进行兼容"></a>低版本 Node.js，使用 Babel 进行兼容</h5><ul>
<li>安装 babel 相关依赖模块</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add @babel/node @babel/core @babel/preset-env --dev</span><br></pre></td></tr></table></figure>
<ul>
<li>运行 ES Modules 的 JS 文件，需要添加特性转换的预设参数</li>
</ul>
<p>babel是基于插件机制实现的，核心模块并不会转换代码，具体转换代码中的每个特性是通过插件来实现的，preset-env 只是一个插件集合，包括了最新js标准的中所有的新特性，可以借助preset-env将代码中ESM转换过来<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn babel-node index.js --presets=@babel/preset-env</span><br></pre></td></tr></table></figure></p>
<p>若不想在执行命令时添加参数，可以配置 .babelrc 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="string">"presets"</span>: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">      <span class="string">"plugins"</span>: [<span class="string">"@babel/plugin-transform-modules-commonjs"</span>]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@babel/preset-env 只是一个插件集合，真正起作用的是 @babel/plugin-transform-modules-commonjs 插件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add @babel/plugin-transform-modules-commonjs --dev</span><br></pre></td></tr></table></figure>
<ul>
<li>运行命令，进行测试</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn babel-node index.js</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>CommonJS规范主要用于服务端编程，加载模块是同步的，这并不适合在浏览器环境，因为同步意味着阻塞加载，浏览器资源是异步加载的，因此有了AMD CMD解决方案。</li>
<li>AMD规范在浏览器环境中异步加载模块，而且可以并行加载多个模块。不过，AMD规范开发成本高，代码的阅读和书写比较困难，模块定义方式的语义不顺畅。</li>
<li>CMD规范与AMD规范很相似，都用于浏览器编程，依赖就近，延迟执行，可以很容易在Node.js中运行。不过，依赖SPM 打包，模块的加载逻辑偏重</li>
<li>ES6 在语言标准的层面上，实现了模块功能，而且实现得相当简单，完全可以取代 CommonJS 和 AMD 规范，成为浏览器和服务器通用的模块解决方案。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.cn/post/6844903744518389768" target="_blank" rel="noopener">前端模块化详解(完整版)</a><br><a href="https://mp.weixin.qq.com/s/0LlNNH0Ev953oIuE43WN-w" target="_blank" rel="noopener">模块化开发</a><br><a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="noopener">模块化编程</a><br><a href="https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88" target="_blank" rel="noopener">AMD中文版</a>)<br><a href="https://zhuanlan.zhihu.com/p/26625636" target="_blank" rel="noopener">理解CommonJS、AMD、CMD三种规范</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/模块化开发/" rel="tag"># 模块化开发</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/21/ES6理解进阶/" rel="next" title="ES6理解进阶">
                <i class="fa fa-chevron-left"></i> ES6理解进阶
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/01/12/vue-router原理剖析/" rel="prev" title="vue-router原理剖析">
                vue-router原理剖析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cat.jpg" alt="Eline">
            
              <p class="site-author-name" itemprop="name">Eline</p>
              <p class="site-description motion-element" itemprop="description">Web前端开发</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Eline302" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#模块化概述"><span class="nav-number">1.</span> <span class="nav-text">模块化概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是模块化"><span class="nav-number">1.1.</span> <span class="nav-text">什么是模块化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块化的发展过程"><span class="nav-number">1.2.</span> <span class="nav-text">模块化的发展过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-原始写法（文件划分方式）"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. 原始写法（文件划分方式）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-对象的写法（命名空间的方式）"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 对象的写法（命名空间的方式）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-立即执行函数写法（IIFE-Immediately-Invoked-Function-Expression）"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 立即执行函数写法（IIFE Immediately-Invoked Function Expression）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块化的规范"><span class="nav-number">2.</span> <span class="nav-text">模块化的规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CommonJS"><span class="nav-number">2.1.</span> <span class="nav-text">CommonJS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述"><span class="nav-number">2.1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优缺点"><span class="nav-number">2.1.2.</span> <span class="nav-text">优缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模块的加载机制"><span class="nav-number">2.1.3.</span> <span class="nav-text">模块的加载机制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AMD（Asynchronous-Module-Definition）"><span class="nav-number">2.2.</span> <span class="nav-text">AMD（Asynchronous Module Definition）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本语法"><span class="nav-number">2.2.1.</span> <span class="nav-text">基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#未使用AMD规范与使用require-js比较"><span class="nav-number">2.2.2.</span> <span class="nav-text">未使用AMD规范与使用require.js比较</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMD"><span class="nav-number">2.3.</span> <span class="nav-text">CMD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CMD规范基本语法"><span class="nav-number">2.3.1.</span> <span class="nav-text">CMD规范基本语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES6-Modules（模块化的最佳实践）"><span class="nav-number">2.4.</span> <span class="nav-text">ES6 Modules（模块化的最佳实践）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ES-Module基本特性"><span class="nav-number">2.4.1.</span> <span class="nav-text">ES Module基本特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES-Module-导入和导出（最为核心和常用的功能）"><span class="nav-number">2.4.2.</span> <span class="nav-text">ES Module 导入和导出（最为核心和常用的功能）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#导出导入语法"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">导出导入语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注意事项"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Polyfill"><span class="nav-number">2.4.3.</span> <span class="nav-text">Polyfill</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES-Modules-in-Node-js"><span class="nav-number">2.4.4.</span> <span class="nav-text">ES Modules in Node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ES-Modules-在-node-js-环境的使用"><span class="nav-number">2.4.4.1.</span> <span class="nav-text">ES Modules 在 node.js 环境的使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ES-Modules-与-CommonJS-交互"><span class="nav-number">2.4.4.2.</span> <span class="nav-text">ES Modules 与 CommonJS 交互</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ES-Modules-与-CommonJs-的差异"><span class="nav-number">2.4.4.3.</span> <span class="nav-text">ES Modules 与 CommonJs 的差异</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#低版本-Node-js，使用-Babel-进行兼容"><span class="nav-number">2.4.4.4.</span> <span class="nav-text">低版本 Node.js，使用 Babel 进行兼容</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">2.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">3.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eline</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
